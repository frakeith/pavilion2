base:
  summary: Builds and runs an MPI-based Hello, World program.
  subtitle: '{{compilers}}-{{mpis}}'
  maintainer:
    name: Nicholas Sly
    email: sly@lanl.gov

  doc: This tests the ability to compile an MPI executable as well as run it across
       multiple nodes and same-node tasks. 

  variables:
    # These are meant to set in the 'host' file.  Create a file in 
    # ../hosts/<your-host-name.yaml>, and add a variables section that sets these.
    compilers?: []
    mpis?: []
    build_flags: ''

  slurm:
    tasks_per_node: 2

  # Create a permuted copy of this test for each compiler and mpi in the 'compilers' and 
  # 'mpis' variables.
  permute_on: [compilers, mpis]

  build:
    timeout: 300
    # Always rebuild this test every time it runs.
    specificity: "{{pav.timestamp}}"
    # This is included in the test_src directory.
    source_path: mpi_hello.c
    modules:
      - "{{compilers}}"
      - "{{mpis}}"
    cmds:
      - "set -x"
      - "$PAV_MPI_CC -o mpi_hello mpi_hello.c {{build_flags}}"
  run:
    timeout: 600
    modules:
      - "{{compilers}}"
      - "{{mpis}}"
    cmds:
      - "set -x"
      - "{{sched.test_cmd}} {{srun_opts}} {{srun_opts_verbose}} ./mpi_hello"
